---
- name: Get Proxmox information
  hosts: pve-test
  gather_facts: no
  vars:
    api_password: "{{ lookup('file', '~/.ansible/.api_pass') | trim }}"
  
  tasks:
    - name: Get version information
      uri:
        url: "https://{{ ansible_host }}:8006/api2/json/version"
        method: GET
        user: "root@pam"
        password: "{{ api_password }}"
        force_basic_auth: yes
        validate_certs: no
        return_content: yes
      register: version_info
      
    - name: Display version information
      debug:
        msg: "Proxmox version: {{ version_info.json.data.version }}"
        
    - name: Get node information
      uri:
        url: "https://{{ ansible_host }}:8006/api2/json/nodes"
        method: GET
        user: "root@pam"
        password: "{{ api_password }}"
        force_basic_auth: yes
        validate_certs: no
        return_content: yes
      register: nodes_info
      
    - name: Display node information
      debug:
        var: nodes_info.json.data
