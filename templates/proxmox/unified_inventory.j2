---
# Proxmox Unified Inventory - Generated by Ansible
# Last updated: {{ inventory_date }}
all:
  children:
    proxmox_resources:
      children:
        proxmox_vms:
          hosts:
{% for vm in vms %}
{% if vm.status == 'running' and vm.template == 0 %}
            {{ vm.name | lower | regex_replace('[^a-zA-Z0-9_-]', '-') }}:
              ansible_host: {{ vm.ip | default('127.0.0.1') }}
              vmid: {{ vm.vmid }}
              node: {{ vm.node }}
              status: {{ vm.status }}
              memory: {{ vm.maxmem }}
              cores: {{ vm.maxcpu }}
              resource_type: vm
{% endif %}
{% endfor %}
        proxmox_templates:
          hosts:
{% for vm in vms %}
{% if vm.template == 1 %}
            template-{{ vm.vmid }}:
              name: {{ vm.name }}
              vmid: {{ vm.vmid }}
              node: {{ vm.node }}
              resource_type: template
{% endif %}
{% endfor %}
        proxmox_containers:
          hosts:
{% for ct in containers %}
{% if ct[2] == 'running' %}
            ct-{{ ct[1] | lower | regex_replace('[^a-zA-Z0-9_-]', '-') }}:
              ansible_host: {{ container_ips.results[loop.index0].stdout | default('127.0.0.1') if container_ips.results[loop.index0].stdout is defined else '127.0.0.1' }}
              ctid: {{ ct[0] }}
              name: {{ ct[1] }}
              status: {{ ct[2] }}
              resource_type: container
{% endif %}
{% endfor %}
        proxmox_nodes:
          hosts:
{% for node in vms | map(attribute='node') | unique %}
            {{ node }}:
              ansible_host: {{ hostvars[node]['ansible_host'] }}
              node_role: {{ hostvars[node]['node_role'] | default('node') }}
              resource_type: node
{% endfor %}
      vars:
        proxmox_managed: true
        proxmox_api_host: "{{ hostvars[vms[0].node]['ansible_host'] if vms | length > 0 else None }}"
        proxmox_api_port: 8006